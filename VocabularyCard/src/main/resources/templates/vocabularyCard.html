<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Vocabulary Card</title>
<link href="https://unpkg.com/sanitize.css" rel="stylesheet">
<link th:href="@{/css/style.css}" rel="stylesheet" type="text/css">
</head>
<body>
	<script type="text/javascript" th:src="@{/js/jquery-3.6.0.min.js}"></script>
	<header>
		<h1 class="title-container">
			<a th:href="@{/vocabularyCard}" class="title">Vocabulary Card</a> <img
				alt="menu" th:src="@{/images/menu.png}"
				class="menuForMobile pointer displayNone">
		</h1>
	</header>

	<div class="container">
		<div id="movedTag" class="displayNone tag">movedTag</div>
		<div class="float-container">
			<!-- 操作メッセージ -->
			<div class="message-container">
				<div th:if="${msg!=null}" class="message">
					<div th:if="${msg.msgType=='E'}" class="error">
						<span class="icon E">×</span> <span th:text="${msg.msgText}"></span>
					</div>
					<div th:if="${msg.msgType=='W'}" class="warnning">
						<span class="icon W">!</span><span th:text="${msg.msgText}"></span>
					</div>
					<div th:if="${msg.msgType=='I'}" class="information">
						<span class="icon I">i</span> <span th:text="${msg.msgText}"></span>
					</div>
				</div>
				<div class="message warnning displayNone" id="speechNotFound">
					<span class="icon W">!</span> <span>お使いのブラウザは音声読み上げに対応していません。</span>
				</div>
			</div>
			<div class="menu-container menuBorder">
				<!-- スクロールで追従する部分 -->

				<div class="menuTab">
					<div class="operationMenuButton menuButton selected">menu</div>
					<div class="tagMenuButton menuButton unselected pointer">tag</div>
				</div>
				<div class="guide menu">
					<div class="operationMenu">


						<table class="flashCardButton">
							<tr>
								<td class="label pointer" id="L1flash">L1</td>
							</tr>
							<tr>
								<td class="separator"></td>
							</tr>
							<tr>
								<td class="label pointer" id="L2flash">L2</td>
							</tr>
						</table>
						<div id="hint" class="pointer">hint</div>
						<div id="speech-container" class="form frameBorder">
							<div id="volume-container">
								<img alt="menu" th:src="@{/images/speaker.png}" class="speaker">
								<input type="range" min=0 max=1 step=0.1
									id="volume">
							</div>
							<div id="lang-container">
								<div>読み上げ言語</div>
								<span class="label">L1</span> <select id="L1lang">
									<option value="en-US">英語(アメリカ)</option>
									<option value="en-GB">英語(イギリス)</option>
									<option value="zh-CN">中国語</option>
									<option value="ko-KR">韓国語</option>
									<option value="jp-JP">日本語</option>
								</select> <br> <span class="label">L2</span> <select id="L2lang">
									<option value="en-US">英語(アメリカ)</option>
									<option value="en-GB">英語(イギリス)</option>
									<option value="zh-CN">中国語</option>
									<option value="ko-KR">韓国語</option>
									<option value="jp-JP">日本語</option>
								</select>
							</div>
						</div>

						<!-- 検索form -->
						<form th:action="@{/vocabularyCard/search}" method="post"
							id="search" th:object="${vocabularyCardQuery}">
							<div class="form frameBorder">
								<input type="text" th:value="*{searchSpelling}"
									name="searchSpelling" class="searchForm menuInput"
									maxlength="50" placeholder="LANGUAGE1"> <input
									type="text" th:value="*{searchMeaning}" name="searchMeaning"
									class="searchForm menuInput" maxlength="50"
									placeholder="LANGUAGE2">
								<button id="doSearch" class="reset">検索</button>
							</div>
						</form>
						<!-- 追加用form -->
						<form th:action="@{/vocabularyCard/create}" method="post"
							th:object="${vocabularyCardData}" class="form">
							<div class="frameBorder">
								<p class="label">LANGUAGE1</p>
								<input type="text" name="spelling1" th:value="*{spelling1}"
									placeholder="word 1(必須)" class="createForm menuInput"
									maxlength="50">
								<div class="error" th:errors="*{spelling1}" th:errorclass="red"></div>
								<input type="text" name="spelling2" th:value="*{spelling2}"
									placeholder="word 2" class="createForm menuInput" max="50">
								<input type="text" name="spelling3" th:value="*{spelling3}"
									placeholder="word 3" class="createForm menuInput"
									maxlength="50">
								<p class="label">LANGUAGE2</p>
								<input type="text" name="meaning1" th:value="*{meaning1}"
									placeholder="word 1" class="createForm menuInput"
									maxlength="50"> <input type="text" name="meaning2"
									th:value="*{meaning2}" placeholder="word 2"
									class="createForm menuInput" maxlength="50"> <input
									type="text" name="meaning3" th:value="*{meaning3}"
									placeholder="word 3" class="createForm menuInput"
									maxlength="50">
								<button type="submit" id="doCreate" class="keep">カード追加</button>
							</div>
						</form>

						<!-- タグ追加用のform -->
						<form th:action="@{/vocabularyCard/createTag}" method="post"
							th:object="${tagData}" class="form">
							<div class="frameBorder">
								<input type="text" name="name" th:value="*{name}"
									placeholder="tag" class="createTagForm menuInput"
									maxlength="30">
								<div class="error" th:if="${#fields.hasErrors('name')}"
									th:errors="*{name}" th:errorclass="red"></div>
								<button type="submit" id="doCreateTag" class="keep">タグ追加</button>
							</div>
						</form>

						<!-- 削除ボタン -->
						<button type="submit" form="checkDelete" id="deleteButton">チェックした項目を削除</button>
					</div>

					<form method="post" th:action="@{/vocabularyCard/search}"
						th:object="${vocabularyCardQuery}" id="searchTag">
						<input type="hidden" th:value="*{searchTag}" name="searchTag"
							id="tagValue">
					</form>
					<form method="post" th:action="@{/vocabularyCard/delete}"
						id="checkDelete"></form>

					<!-- タグ表示及びタグ検索 jsでinputに上書き、各タグボタンをクリック時に送信 -->
					<div class="tagMenu displayNone">
						<div th:each="tag:${tagList}" class="tagList reset">
							<button th:text="${tag.name}" class="tag pointer"
								draggable="true" form="searchTag"></button>
							<input type="checkbox" class="check-delete-tag checkbox"
								name="deletedTagId" th:value="${tag.id}" form="checkDelete">
						</div>

						<!-- ドラッグアンドドロップで使用するカードid、タグ名送信用のフォーム -->

						<form method="post" th:action="@{/vocabularyCard/addTag}"
							id="addTag">
							<input type="hidden" name="cardId" id="addedCard"> <input
								type="hidden" name="draggedTag" id="addedTag">
						</form>
					</div>
				</div>
			</div>
		</div>

		<!-- カードの数だけ<div>を生成  タグには検索用フォームと関連付ける-->
		<div th:each="vc:${cardList}" class="card displayByPage">
			<div th:text="${vc.id}" class="id"></div>
			<section class="tags">
				<button th:if="${vc.tag1!=null && vc.tag1!=''}" type="submit"
					th:text="${vc.tag1}" class="tag pointer" form="searchTag"></button>
				<br>
				<button th:if="${vc.tag2!=null && vc.tag2!=''}" type="submit"
					th:text="${vc.tag2}" class="tag pointer" form="searchTag"></button>
				<br>
				<button th:if="${vc.tag3!=null && vc.tag3!=''}" type="submit"
					th:text="${vc.tag3}" class="tag pointer" form="searchTag"></button>
			</section>

			<section class="wordList">
				<p class="label">L1</p>
				<div class="L1">
					<div class="eachWord">
						<span th:text="${vc.spelling1}" class="L1hidden correct"
							id="spelling1"></span> <span
							class="L1writeIn displayNone writeIn"><input type="text"
							placeholder=""><span class="L1Length"></span></span>
						<button class="check L1check" draggable="true">⇔</button>
						<button class="L1speakButton">再生</button>
						<br>
					</div>
					<div th:unless="${vc.spelling2.isEmpty()}" class="eachWord">
						<span th:text="${vc.spelling2}" class="L1hidden correct"
							id="spelling2"></span> <span
							class="L1writeIn displayNone writeIn"><input type="text"
							placeholder=""><span class="L1Length"></span> </span>
						<button class="check L1check" draggable="true">⇔</button>
						<button class="L1speakButton">再生</button>
						<br>
					</div>
					<div th:unless="${vc.spelling3.isEmpty()}" class="eachWord">
						<span th:text="${vc.spelling3}" class="L1hidden correct"
							id="spelling3"></span> <span
							class="L1writeIn displayNone writeIn"><input type="text"
							placeholder=""><span class="L1Length"></span> </span>
						<button class="check L1check" draggable="true">⇔</button>
						<button class="L1speakButton">再生</button>
					</div>
				</div>
				<p class="label">L2</p>
				<div class="L2">
					<div th:unless="${vc.meaning1.isEmpty()}" class="eachWord">
						<span th:text="${vc.meaning1}" class="L2hidden correct"></span> <span
							class="L2writeIn displayNone writeIn"><input type="text"
							placeholder=""><span class="L2Length"></span></span>
						<button class="check L2check" draggable="true">⇔</button>
						<button class="L2speakButton">再生</button>
						<br>
					</div>
					<div th:unless="${vc.meaning2.isEmpty()}" class="eachWord">
						<span th:text="${vc.meaning2}" class="L2hidden correct"></span> <span
							class="L2writeIn displayNone writeIn"><input type="text"
							placeholder=""><span class="L2Length"></span></span>
						<button class="check L2check" draggable="true">⇔</button>
						<button class="L2speakButton">再生</button>
						<br>
					</div>
					<div th:unless="${vc.meaning3.isEmpty()}" class="eachWord">
						<span th:text="${vc.meaning3}" class="L2hidden correct"></span> <span
							class="L2writeIn displayNone writeIn"><input type="text"
							placeholder=""><span class="L2Length"></span></span>
						<button class="check L2check" draggable="true">⇔</button>
						<button class="L2speakButton">再生</button>
					</div>
				</div>
			</section>
			<div class="check-delete">
				<p class="No">
					No.<span></span>
				</p>
				<form th:action="@{/vocabularyCard/__${vc.id}__}" name="edit"
					method="post">
					<button class="editButton pointer keep" type="submit">編集</button>
				</form>
				<input type="checkbox" th:value="${vc.id}" name="deletedId"
					class="checkbox" form="checkDelete">
			</div>
			<div class="float-end"></div>
		</div>
		<br>
	</div>
	<footer>
		<ul class="footerMenu">
			<li><a th:href="@{/logout}">ログアウト</a></li>
			<li><a th:href="@{/vocabularyCard/operation}" class="keep">つかいかた</a></li>
		</ul>
		<ul class="navi">
		</ul>
	</footer>

	<script>
	'use strict';

	//スクロール位置を保持する

	function keepPosition(){
		var xpos=document.documentElement.scrollLeft||document.body.scrollLeft;
		var ypos=document.documentElement.scrollTop||document.body.scrollTop;
		sessionStorage.setItem("xpos",xpos);
		sessionStorage.setItem("ypos",ypos);
	}
	function resetPosition(){
		sessionStorage.setItem("xpos",0.0);
		sessionStorage.setItem("ypos",0.0);
	}
	if(sessionStorage.getItem("xpos")==null){
		resetPosition();
	}
	window.onload=function(){
			window.scrollTo(sessionStorage.getItem("xpos"),sessionStorage.getItem("ypos"));
	}

	//位置を保持/operation,/create,/createTag,/delete,/id,/addTag
	//addTagのみクリックイベントではないので、個別に設定
	$(".keep").on("click",function(){
		keepPosition();
	});
	//位置をリセット/search
	$(".reset").on("click",function(){
		resetPosition;
	});

	//カード番号を表示
	const card=document.getElementsByClassName("card");
	const number=document.querySelectorAll(".check-delete>p>span");
	for(i=0;i<card.length;i++){
		number[i].textContent=i+1;
	}

	//ドラッグアンドドロップ機能
	const tag=document.querySelectorAll(".tagList>.tag");
	const wordList=document.getElementsByClassName("wordList");
	const idList=document.getElementsByClassName("id");
	const form=document.getElementById("addTag");
if(screen.width>480){
	let draggedTag;
	let clickedTag;
	//全タグボタンにドラッグイベントとクリックイベントを設定、タグ名を取得
	for(let i=0;i<tag.length;i++){
		tag[i].addEventListener('dragstart',(event)=>{
			draggedTag=tag[i].textContent;
		});
		tag[i].addEventListener('click',(event)=>{
			//event.preventDefault();
			clickedTag=tag[i].textContent;
			//タグ検索フォームに代入
			document.getElementById('tagValue').value=clickedTag;
		});
		tag[i].addEventListener("drag",(event)=>{
			console.log("drag");
			event.preventDefault();
		});
	}
	let cardId;
	for(let i=0;i<wordList.length;i++){
	wordList[i].addEventListener("dragover",(event)=>{
		event.preventDefault();
	});
	wordList[i].addEventListener("drop",(event)=>{
		event.preventDefault();
		cardId=idList[i].textContent;

	document.getElementById("addedCard").value=cardId;
	document.getElementById("addedTag").value=draggedTag;
	//スクロール位置の保持
	keepPosition();
	form.submit();
	});
	}
}else{
	//スマホ用のドラッグアンドドロップ
	let X;
    let Y;
    let cardId;
    var wordListArray=[].slice.call(wordList);
    var movedTag=document.getElementById("movedTag");

	function touchStartEvent(event){
		event.preventDefault();
		var touchObject = event.changedTouches[0];
        X=touchObject.clientX;
        Y=touchObject.clientY;
        movedTag.style.position="fixed";
        movedTag.style.left=X+"px";
        movedTag.style.top=Y+"px";
		var touchObject = event.changedTouches[0];
        movedTag.textContent=event.target.textContent;
        movedTag.classList.toggle("displayNone");
        document.getElementById("addedTag").value=event.target.textContent;
	}
	function touchMoveEvent(event){
		event.preventDefault();
		var touchObject = event.changedTouches[0];
        X=touchObject.clientX;
        Y=touchObject.clientY;
        movedTag.style.left=X+"px";
        movedTag.style.top=Y+"px";
        console.log("X:"+X+",Y:"+Y);
	}
	function touchEndEvent(event){
		event.preventDefault();
        movedTag.style.position="";
        //elementfromPoint()は最もネストされた要素を取得するため、その親要素がwordListかを判定する
        var droppedCard=document.elementFromPoint(X,Y).closest(".wordList");
        movedTag.style.left=X+"";
        movedTag.style.top=Y+"";
        movedTag.classList.toggle("displayNone");
        if(droppedCard.className=="wordList"){
          var cardNumber=wordListArray.indexOf(droppedCard);
          console.log(cardNumber);
          cardId=idList[cardNumber].textContent;
          document.getElementById("addedCard").value=cardId;
          console.log("true"+cardId);
          //スクロール位置の保持
      	  keepPosition();
          form.submit();
        }else{
          cardId=-1;
          console.log("false"+cardId);
        }
      }
      for(var i=0;i<tag.length;i++){
        tag[i].addEventListener("touchstart",touchStartEvent);
        tag[i].addEventListener("touchmove",touchMoveEvent);
        tag[i].addEventListener("touchend",touchEndEvent);
      }
	for(var i=0;i<tag.length;i++){
		tag[i].addEventListener("touchstart",touchStartEvent,false);
		tag[i].addEventListener("touchmove",touchMoveEvent,false);
		tag[i].addEventListener("touchend",touchEndEvent,false);
	}
}

	//ページネイション機能
	//cardを配列として取得
	const cardList=document.getElementsByClassName('card');
	var array=Array.prototype.slice.call(cardList);
	if(array.length!=0){
		const navi=document.querySelector(".navi");
		//全体を表示件数で割り、商の数だけページ番号を作成。
		for(let i=1;i<array.length/50+1;i++){
			const liElement=document.createElement('li');
			liElement.innerHTML='<li class="pageNumber pointer">'+i+'</li>';
			navi.insertAdjacentElement('beforeend',liElement);
		}
		//追加した<li>タグの個数分の配列を作成。
		let pageNumber=document.getElementsByClassName('pageNumber');
		var arrayPage=Array.prototype.slice.call(pageNumber);
		//1ページ目を最初に表示し、pointerをoffにする。currentPage==arrayPage[currentPage-1].textContent
		let currentPage=1;
		arrayPage[0].classList.toggle("pointer");
		//カード50個にtoggleを行うメソッドを定義。
		var displayCard=function(currentPage,array){
			for(let i=(currentPage-1)*50;i<((currentPage-1)*50)+50;i++){
			if(i+1>array.length)break;
			array[i].classList.toggle('displayByPage');
		}};
		displayCard(currentPage,array);
		//各ページ番号にクリック時のイベントを割り当てる。arrayPage[0]=1であることに注意
		for(let i=0; i<arrayPage.length;i++){
			arrayPage[i].addEventListener("click",(event)=>{
				if(currentPage==arrayPage[i].textContent){
					return;
				}else{
					//クリック前のページを非表示にし、pointerを付与
					displayCard(currentPage,array);
					arrayPage[currentPage-1].classList.toggle("pointer");
					//クリックしたページ番号に更新
					currentPage=(arrayPage[i].textContent);
					//更新後のページを表示し、pointerを削除
					displayCard(currentPage,array);
					arrayPage[currentPage-1].classList.toggle("pointer");
					window.scroll(0,0);
					}
	});
	}
	}

    //input入力内容があった場合にのみボタンをクリックできるようにする
	function enableClick(button,inputArray){
    	button.disabled=true;
		for(var i=0;i<inputArray.length;i++){
			inputArray[i].addEventListener('input',(event)=>{
				for (var j=0;j<inputArray.length;j++){
					if(inputArray[j].value.trim()!=null&&inputArray[j].value.trim()!==""){
    				button.disabled=false;
    				break;
    				}else{
    					button.disabled=true;
    				}
    			}
    		});
		}
	}
    //各formに設定
	var searchForm=document.getElementsByClassName('searchForm');
	var searchButton=document.getElementById('doSearch');
	enableClick(searchButton,searchForm);
	var createForm=document.getElementsByClassName('createForm');
	var createButton=document.getElementById('doCreate');
	enableClick(createButton,createForm);
	var createTagForm=document.getElementsByClassName('createTagForm');
	var createTagButton=document.getElementById('doCreateTag');
	enableClick(createTagButton,createTagForm);

	//チェック時に削除ボタンを押せるようにする
	const checkboxArray=document.getElementsByClassName("checkbox");
	let deleteButton=document.getElementById('deleteButton');
	for(var i=0;i<checkboxArray.length;i++){
		deleteButton.disabled=true;
		checkboxArray[i].addEventListener('change',(event)=>{
			for(var j=0;j<checkboxArray.length;j++){
			if(checkboxArray[j].checked==true){
				deleteButton.disabled=false;
				break;
			}else{
				deleteButton.disabled=true;
			}
			}
		});
	}

	//カード作成フォームをエンターキーでフォーカス移動するように設定
	for(let i=0;i<createForm.length;i++){
		createForm[i].addEventListener("keypress",(event)=>{
			if(event.keyCode===13){
				event.preventDefault();
				if(i+1<createForm.length){
				createForm[i+1].focus();
				}
			}
		});
	}
	//カード追加ボタンのエンターキーでの送信を無効にする

	//spellingTest機能
	var L1flash=document.getElementById("L1flash");
	var L2flash=document.getElementById("L2flash");
    var L1hidden=document.querySelectorAll(".L1hidden");
	var L2hidden=document.querySelectorAll(".L2hidden");
	var L1writeIn=document.querySelectorAll(".L1writeIn");
	var L2writeIn=document.querySelectorAll(".L2writeIn");
	var L1Length=document.querySelectorAll(".L1Length");
	var L2Length=document.querySelectorAll(".L2Length");
	//正解の単語の文字数を表示
	for(let i=0;i<L1hidden.length;i++){
		L1Length[i].textContent="(" + L1hidden[i].textContent.length + ")";
	}
	for(let i=0;i<L2hidden.length;i++){
		L2Length[i].textContent="(" + L2hidden[i].textContent.length + ")";
	}
	//回答⇔一覧の切り替えを設定
	//表示=0,非表示=1
	let currentL1Switch=0;
	let currentL2Switch=0;
	$("#L1flash").on("click",function(){
		if(currentL1Switch==0){
			for(let i=0;i<L1hidden.length;i++){
				if(!L1hidden[i].classList.contains('displayNone')){
					L1hidden[i].classList.toggle('displayNone');
					L1writeIn[i].classList.toggle('displayNone');
				}
			}
			currentL1Switch=1;
		}else{
			for(let i=0;i<L1hidden.length;i++){
				if(L1hidden[i].classList.contains('displayNone')){
					L1hidden[i].classList.toggle('displayNone');
					L1writeIn[i].classList.toggle('displayNone');
				}
			}
			currentL1Switch=0;
		}
	});
	$("#L2flash").on("click",function(){
		if(currentL2Switch==0){
			for(let i=0;i<L2hidden.length;i++){
				if(!L2hidden[i].classList.contains('displayNone')){
					L2hidden[i].classList.toggle('displayNone');
					L2writeIn[i].classList.toggle('displayNone');
				}
			}
			currentL2Switch=1;
		}else{
			for(let i=0;i<L2hidden.length;i++){
				if(L2hidden[i].classList.contains('displayNone')){
					L2hidden[i].classList.toggle('displayNone');
					L2writeIn[i].classList.toggle('displayNone');
				}
			}
			currentL2Switch=0;
		}
	});
	//スペルを一文字ごとに判定する
	//イベントを作成
	let clickEvent=new MouseEvent("click");
	//let check=document.querySelectorAll(".check");
	let L1check=document.querySelectorAll(".L1check");
	let L2check=document.querySelectorAll(".L2check");
    let perChar=[];
    let result="<p class='correct'>";
    //答え合わせ用ボタンごとにイベントを設定
  	function checkAndMove(check,answerArray,correctArray,writeInArray){
  		for(let i=0;i<check.length;i++){
  	  		//エンターキーを押したときにcheckボタンをクリックするイベントを発火させる
  	  		answerArray[i].addEventListener('keypress',(event)=>{
  	  			if(event.keyCode===13){
  	  				check[i].dispatchEvent(clickEvent);
  	  			}
  	  		});
  	  		//クリックイベントを設定
  	  		check[i].addEventListener('click',(event)=>{
  	        let answer=answerArray[i].value;
  	        let correct=correctArray[i].textContent;
  	        let result="<span class='correct'>";
  	        let rightChar=[];
  	        //回答を一文字ずつ取得し、正解と比較
  	        for(let j=0;j<answer.length;j++){
  	        	//正解の文字列を超えた場合はbreak
  	      		if(j>correct.length)break;
  	        	//正解の文字番号を配列に格納
  	      		if(answer.charAt(j)==correct.charAt(j)){
  	            rightChar.push(j);
  	      		}
  	      	}
  	        //正解の文字はそのまま文字列に追加、不正解は<span>を付けて追加
  	        for(let k=0;k<correct.length;k++){
  	          if(rightChar.includes(k)){
  	            result+=correct.charAt(k);
  	          }else{
  	            result+=('<span class="red">'+correct.charAt(k)+'</span>');
  	          }
  	        }
  	        result+="</span>"
  	        correctArray[i].innerHTML=result;
  	  		//回答欄⇔答えの切り替え
  	  		writeInArray[i].classList.toggle('displayNone');
  	  		correctArray[i].classList.toggle('displayNone');
  	  		//次の回答欄にフォーカス
  	  		if(i+1<answerArray.length){
  	  			answerArray[i+1].focus();
  	  		}
  	  		});
  	  	}
    }
    //checkAndMoveを設定
    let L1answer=document.querySelectorAll(".L1writeIn>input");
    let L2answer=document.querySelectorAll(".L2writeIn>input");
  	checkAndMove(L1check,L1answer,L1hidden,L1writeIn);
  	checkAndMove(L2check,L2answer,L2hidden,L2writeIn);

	//頭文字を表示する
	let allAnswers=document.querySelectorAll(".writeIn>input");
    let allCorrects=document.querySelectorAll(".correct");
    let hint=document.getElementById("hint");
    hint.addEventListener("click",(event)=>{
    	for(let i=0;i<allCorrects.length;i++){
    		let answer=allAnswers[i];
    		let correct=allCorrects[i];
    		answer.placeholder=correct.textContent.charAt(0);
    	}
    });

    //読みあげ機能
    if("speechSynthesis" in window){
    	console.log("true");
   	 	var L1speak=document.getElementsByClassName("L1speakButton");
    	var L2speak=document.getElementsByClassName("L2speakButton");
   		for(let i=0;i<L1speak.length;i++){
    		L1speak[i].addEventListener("click",function(){
    			const uttr=new SpeechSynthesisUtterance(L1hidden[i].textContent);
    			uttr.lang=document.getElementById("L1lang").value;
    			uttr.volume=document.getElementById("volume").value;
    			speechSynthesis.speak(uttr);
    		});
    	}
		for(let i=0;i<L2speak.length;i++){
	    	L2speak[i].addEventListener("click",function(){
    			const uttr=new SpeechSynthesisUtterance(L2hidden[i].textContent);
    			uttr.lang=document.getElementById("L2lang").value;
    			uttr.volume=document.getElementById("volume").value;
	    		speechSynthesis.speak(uttr);
    		});
    	}
    }else{
    	console.log("false");
    	$("#speechNotFound").removeClass("displayNone");
    }

	//メニューの切り替えを設定
	let menu=0;
	function changeMenu(){
		$(".operationMenu").toggleClass("displayNone");
		$(".operationMenuButton").toggleClass("selected");
		$(".operationMenuButton").toggleClass("unselected");
		$(".operationMenuButton").toggleClass("pointer");
		$(".tagMenu").toggleClass("displayNone");
		$(".tagMenuButton").toggleClass("unselected");
		$(".tagMenuButton").toggleClass("selected");
		$(".tagMenuButton").toggleClass("pointer");
	}
	var operationMenu=document.querySelectorAll(".operationMenu");
	$(".operationMenuButton").on("click",function(){
		if(menu===0){
			return;
		}else{
			changeMenu();
			menu=0;
		}
	});
	var tagMenu=document.querySelectorAll(".tagMenu");
	$(".tagMenuButton").on("click",function(){
		if(menu===1){
			return;
		}else{
			changeMenu();
			menu=1;
		}
	});

	//menuの追従、スマホ用の設定
	if(screen.width<480){
		$(".menuForMobile").toggleClass("displayNone");
		$(".float-container").toggleClass("displayNone");
		$(".menuForMobile").on("click",function(){
			console.log("a");
			$(".float-container").toggleClass("displayNone");
		});
	}/*else{
		//css の position: sticky が反映されないため、javascript で実装
		//画面全体の高さを取得し、その15%の高さに設定する。操作メッセージも考慮し、15%をstickyの境界にする
		//menuの最初の位置の高さを設定
		let firstHeight=screen.availHeight*0.15;
		console.log(firstHeight);
		$('.menu-container').css('position',firstHeight+"px");
		var menuContainer=document.querySelector(".menu-container");
		menuContainer.style.top=firstHeight+"px";
		console.log($('.menu-container').offset().top);
		$(window).on('scroll',function(){
			let secondHeight=$('.menu-container').offset().top;
			//スクロール量を取得
			let scroll=$(window).scrollTop();
			//スクロール量がmenuの高さを上回ったらstickyを追加、下回ったら削除
			if(scroll>firstHeight){
				menuContainer.style.position="fixed";
				//$(".menu-container").addClass('sticky');
			}else{
				//$(".menu-container").removeClass('sticky');
				menuContainer.style.position="";
			}
		});
	}*/

	</script>
</body>
</html>